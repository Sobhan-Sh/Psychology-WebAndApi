@model IEnumerable<PC.Dto.Psychologist.Comment.CommentViewModel>


<section class="container row pt-4 mt-5 pt-md-2 mt-md-3 mx-auto px-0 px-md-2">
    <aside class="col-11 col-md-3 mx-auto mx-md-0">
        <partial name="_NavbarProfile" />
    </aside>
    <section class="col-11 col-md-9 mx-auto mx-md-0 mt-3 mt-md-0 px-0 px-md-2">
        <!--* card -->
        <section class="card mx-auto pt-5 pb-3 card-profile-form">
            <!--* title card -->
            <section class="card-title">
                <h3>
                    چت
                </h3>
            </section>
            <hr>
            <!--* body card -->
            <section class="card-body px-0 chat_cart">
                @{
                    //TODO: اینجا با چک کردن تاریخ اضافه کردن اون پیام چک می کنی اگر شب به روز تبدیل شد بود یعنی 24 ساعت گزشت باید نشون بده
                }
                <section class="row">
                    <section class="col-12">
                        <span>
                            سلام اقای دکتر من حیدری هستم.
                            <br />
                            اقای دکتر مریضی پسرم راه درمانی هم داره
                        </span>
                    </section>

                    <section class="chat_me col-12">
                        <span>
                            سلام خانم حیدری
                            <br />
                            بله خانوم حیدری نگران نباشید بنده با تمام توانم سعی به بهتر کردن حال فرزند شما کنم
                        </span>
                    </section>

                    <section class="col-12">
                        <span>
                            مرسی اقای دکتر
                        </span>
                    </section>

                    <section class="col-12 chat_me description_image">
                        <span>
                            <img src="/assets/imageTemplate/background_chat.jpg" />
                            بفرما خانوم حیدری اینم چارت مداوای بیماری
                        </span>
                    </section>

                    <section class="col-12 gallery_image">
                        <span>
                            <img src="/assets/imageTemplate/background_chat.jpg" />
                            <img src="/assets/imageTemplate/background_chat.jpg" />
                            <img src="/assets/imageTemplate/background_chat.jpg" />
                            <img src="/assets/imageTemplate/background_chat.jpg" />
                        </span>
                    </section>
                </section>

            </section>

            <section class="selectListImage_upload d-none">
                <section></section>
                <button type="button" onclick="" class="btn btn-custom d-flex my-2">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="30px" fill="currentColor" class="w-6 h-6">
                        <path d="M3.478 2.404a.75.75 0 0 0-.926.941l2.432 7.905H13.5a.75.75 0 0 1 0 1.5H4.984l-2.432 7.905a.75.75 0 0 0 .926.94 60.519 60.519 0 0 0 18.445-8.986.75.75 0 0 0 0-1.218A60.517 60.517 0 0 0 3.478 2.404Z" />
                    </svg>
                    ارسال
                </button>
            </section>


            <!-- keyDown_active  -->
            <section class="btn_send_dataChat d-flex align-items-center">
                <input placeholder="سخن بگو" class="cusotm-form-controle" id="message" />
                <button>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                        <path d="M3.478 2.404a.75.75 0 0 0-.926.941l2.432 7.905H13.5a.75.75 0 0 1 0 1.5H4.984l-2.432 7.905a.75.75 0 0 0 .926.94 60.519 60.519 0 0 0 18.445-8.986.75.75 0 0 0 0-1.218A60.517 60.517 0 0 0 3.478 2.404Z" />
                    </svg>
                </button>
                <button>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                        <path fill-rule="evenodd" d="M18.97 3.659a2.25 2.25 0 0 0-3.182 0l-10.94 10.94a3.75 3.75 0 1 0 5.304 5.303l7.693-7.693a.75.75 0 0 1 1.06 1.06l-7.693 7.693a5.25 5.25 0 1 1-7.424-7.424l10.939-10.94a3.75 3.75 0 1 1 5.303 5.304L9.097 18.835l-.008.008-.007.007-.002.002-.003.002A2.25 2.25 0 0 1 5.91 15.66l7.81-7.81a.75.75 0 0 1 1.061 1.06l-7.81 7.81a.75.75 0 0 0 1.054 1.068L18.97 6.84a2.25 2.25 0 0 0 0-3.182Z" clip-rule="evenodd" />
                    </svg>
                    <input onchange="UploadListImage(this)" multiple type="file" accept=".jpg,.jpeg,.png" />
                </button>
            </section>
        </section>
    </section>
</section>

<section class="mx-auto container">





    <div>
        <ul id="messagesList"></ul>
    </div>
    <div class="mx-auto d-flex flex-column">
        @*         <input class="form-control my-1" type="text" id="userInput" placeholder="Enter your name" />
        <input class="form-control my-1" type="text" id="messageInput" placeholder="Enter your message" />
        <button class="btn btn-primary btn-sm my-1" id="sendButton">Send</button>
        *@
        <input type="file" id="fileInput" />
        <button id="uploadBtn">Upload</button>
    </div>
</section>

@section Scripts
{
    <script src="/js/signalr/dist/browser/signalr.min.js"></script>

    <script>

        const UploadListImage = (event) => {
            processImages(event.files);
        }

        const processImages = (files) => {
            $(".selectListImage_upload").removeClass("d-none");
            let imageSection = $(".selectListImage_upload section");

            imageSection.empty();
            let number = 1;
            for (var i = 0; i < files.length; i++) {
                var file = files[i];

                let reader = new FileReader();
                reader.onload = (e) => {
                    let spanElement = $(`<span id='ss${number}'>`)
                        .html(`<img src="${e.target.result}" ><svg onclick="DeleteImageFromSelectListImage_upload('#ss${number}')" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" /></svg>`);
                    number++;
                    imageSection.append(spanElement);
                };

                reader.readAsDataURL(file);
            }

            alert("Images processed successfully!");
        }

        const DeleteImageFromSelectListImage_upload = (code) => {
            let span = $(code);
            span.hide("slow");
            setTimeout(() => {
                span.remove();
                if ($('.selectListImage_upload span').length === 0)
                    $('.selectListImage_upload').addClass('d-none');
            }, 400);
        }

        $(document).ready(function () {
            // زمانی که دکمه‌ای با id="uploadBtn" کلیک شود
            $("#uploadBtn").on("click",
                function () {
                    // المان ورودی فایل را بگیرید
                    var fileInput = $("#fileInput")[0];

                    // چک کنید که المان ورودی فایل فعال است و حاوی حداقل یک فایل است
                    if (fileInput && fileInput.files.length > 0 && fileInput.files[0]) {
                        // اگر فایل انتخاب شده است، اطلاعات فرم را جمع‌آوری کنید
                        var form = new FormData();
                        var filePath = fileInput.files[0].webkitRelativePath || fileInput.files[0].name;

                        form.append("file", fileInput.files[0], filePath);

                        // تنظیمات برای ارسال به سمت سرور
                        var settings = {
                            "url": "https://localhost:44321/Profile/FileUpload",
                            "method": "POST",
                            "timeout": 0,
                            "headers": {
                                "Cookie": ".AspNetCore.Antiforgery.XK-DWU278lE=CfDJ8D-aNHRHrCBPgY2sZ0d73IuI_jY1fFMJf1yrIsjolWUG8aZBZZwloA_uhTpmnMazSloMealxYdOHeYuntBrXaL2zS9aVgl6hbMMztKxZ2iRpxbSE_d_zTT2Gj9eM7GKbwqnXqA9uErl79RMyTKbDLQY"
                            },
                            "processData": false,
                            "mimeType": "multipart/form-data",
                            "contentType": false,
                            "data": form
                        };

                        // ارسال درخواست به سمت سرور
                        $.ajax(settings).done(function (response) {
                            // نتیجه را در کنسول چاپ کنید
                            console.log(response);
                        });
                    } else {
                        // اگر المان ورودی فایل غیرفعال است یا حاوی فایل نیست، یک پیام خطا یا اعلان را نمایش دهید
                        alert("Please select a file before clicking the upload button.");
                    }
                });
        });

        // "use strict";

        // var connection = new signalR.HubConnectionBuilder().withUrl("/chatHub").build();

        // // Disable the send button until connection is established.
        // document.getElementById("sendButton").disabled = true;

        // connection.on("ReceiveMessage", function (user, message) {
        //     var li = document.createElement("li");
        //     document.getElementById("messagesList").appendChild(li);
        //     // We can assign user-supplied strings to an element's textContent because it
        //     // is not interpreted as markup. If you're assigning in any other way, you
        //     // should be aware of possible script injection concerns.
        //     li.textContent = `${user} says ${message}`;
        // });

        // connection.start().then(function () {
        //     document.getElementById("sendButton").disabled = false;
        // }).catch(function (err) {
        //     return console.error(err.toString());
        // });

        // document.getElementById("sendButton").addEventListener("click", function (event) {
        //     var user = document.getElementById("userInput").value;
        //     var message = document.getElementById("messageInput").value;
        //     connection.invoke("SendMessage", user, message).catch(function (err) {
        //         return console.error(err.toString());
        //     });
        //     event.preventDefault();
        // });
    </script>
}
